# Anan's Sketchbook API

本项目基于 [安安的素描本聊天框](https://github.com/MarkCup-Official/Anan-s-Sketchbook-Chat-Box) 开发，提供了一个 Web API 接口实现。

一个将文本内容生成到安安素描本上的API服务，支持文本渲染、表情差分和自定义配置。

## 项目简介

本项目提供了一个 Web API 接口，允许用户通过HTTP请求将文本内容渲染到安安素描本的图片上。项目支持多种表情差分、文本样式定制和图片生成，并提供了灵活的配置选项。

## 功能特性

- 文本自动渲染到素描本上
- 多种表情差分支持（普通、开心、生气、无语、脸红、病娇）
- 文本颜色和样式自定义
- 灵活的配置系统，使用TOML格式
- 自动获取工作目录，支持相对路径配置
- 配置文件和日志统一存储在data目录

## 项目结构

```text
├── BaseImages/       # 基础图片资源，包含不同表情的安安图片
├── api/              # API接口定义
├── core/             # 核心功能模块
├── data/             # 数据目录（配置文件、日志、生成的图片）
│   ├── config.toml   # 配置文件（TOML格式）
│   ├── log/          # 日志文件目录
│   └── sketchbooks/  # 生成的素描本图片
├── drawer/           # 素描本绘制功能
├── fonts/            # 字体文件目录
├── utils/            # 工具函数模块
├── main.py           # 应用入口文件
└── requirements.txt  # 项目依赖
```

## 配置系统

项目使用TOML格式的配置文件，配置文件位于`data/config.toml`。主要配置项包括：

- `project_name`: 项目名称
- `work_dir`: 工作目录（自动获取）
- `log_path`: 日志文件路径（默认：data/log）
- `output_path`: 输出文件路径
- `api_route`: API路由前缀
- `api_port`: API服务端口
- `api_host`: API服务主机地址
- `api_token`: API认证令牌（留空表示不启用认证）
- `domain`: 域名配置
- `resource_path`: 资源路径配置（图片、字体等）

所有路径配置均支持相对路径，相对于项目根目录解析。

## 部署指南

### 环境要求

- Python 3.8+
- 依赖项见requirements.txt

### 安装步骤

1. 克隆项目代码

2. 安装依赖：
```bash
pip install -r requirements.txt
```

3. 运行服务：
```bash
python main.py
```

### Docker部署（可选）

可以通过创建Dockerfile进行容器化部署。

## API使用

服务启动后，可以通过以下API进行交互：

### 文本转素描本图片

**请求**: POST /api/v1/draw

**参数**:
- `text`: 要绘制的文本内容
- `expression` (可选): 表情类型（普通、开心、生气、无语、脸红、病娇）
- `color` (可选): 文本颜色（RGB格式）

**返回**: 生成的素描本图片（PNG格式）

### API文档

服务启动后，可以访问以下地址查看完整的API文档：
- Swagger UI: http://[host]:[port]/docs

## 开发说明

### 配置系统更新

本项目的配置系统已经过优化：
1. 使用TOML格式替代JSON，提供更清晰的配置结构
2. 自动获取工作目录，不再需要硬编码绝对路径
3. 所有配置路径支持相对路径，并自动相对于工作目录解析
4. 配置文件和日志统一存储在data目录，便于数据管理和备份

### 表情差分

在文本中使用特殊标签可以切换安安的表情：
- `#普通#`: 普通表情
- `#开心#`: 开心表情
- `#生气#`: 生气表情
- `#无语#`: 无语表情
- `#脸红#`: 脸红表情
- `#病娇#`: 病娇表情

### 特殊文本格式

- 使用`[]`或`【】`包裹的文本会显示为紫色

## 注意事项

- 字体文件`font.ttf`位于fonts目录，可以替换为其他字体
- 底图文件位于BaseImages目录，如需更换底图，请确保保持相同的分辨率
- 生成的图片默认保存在data/sketchbooks目录下

## 许可证

本项目仅用于学习和研究目的。

## 更新记录

- 更新配置系统为TOML格式
- 优化路径处理，使用相对路径
- 统一配置和日志到data目录
- 重构核心代码结构